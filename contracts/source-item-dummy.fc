;;fix
;;  Source item smart contract - DUMMY FOR TESTS
;;

#pragma version >=0.2.0;
#include "imports/stdlib.fc";

const int error::access_denied = 401;
const int error::unknown_op = 0xffff;

;;
;;  Storage
;;
;;  uint256 verifier_id
;;  uint256 verified_code_cell_hash
;;  MsgAddressInt source_item_registry
;;  cell content
;;
(int, int, int, slice, cell) load_data() {
    slice ds = get_data().begin_parse();
    var (verifier_id, verified_code_cell_hash, source_item_registry) = (ds~load_uint(256), ds~load_uint(256), ds~load_msg_addr());
    if (ds.slice_refs() > 0) {
      return (-1, verifier_id, verified_code_cell_hash, source_item_registry, ds~load_ref());
    } else {
      return (0, verifier_id, verified_code_cell_hash, source_item_registry, null()); ;; not initialized yet
    }
}

() store_data(int verifier_id, int verified_code_cell_hash, slice source_item_registry, cell content) impure {
    set_data(
        begin_cell()
            .store_uint(verifier_id, 256)
            .store_uint(verified_code_cell_hash, 256)
            .store_slice(source_item_registry)
            .store_ref(content)
            .end_cell()
    );
}

() recv_internal(int my_balance, int msg_value, cell in_msg_full, slice in_msg_body) impure {
    if (in_msg_body.slice_empty?()) { ;; ignore empty messages
        return ();
    }

    slice cs = in_msg_full.begin_parse();
    int flags = cs~load_uint(4);

    if (flags & 1) { ;; ignore all bounced messages
        return ();
    }
    slice sender_address = cs~load_msg_addr();

    (int init?, int verifier_id, int verified_code_cell_hash, slice source_item_registry, cell content) = load_data();
    if (~ init?) {
      throw_unless(error::access_denied, equal_slices(source_item_registry, sender_address));
      store_data(verifier_id, verified_code_cell_hash, source_item_registry, begin_cell().store_slice(in_msg_body).end_cell());
      return ();
    }

    throw(error::unknown_op);
}

;;
;;  GET Methods
;;
(int, int, int, slice, cell) get_dummy_data() method_id {
  (int init?, int verifier_id, int verified_code_cell_hash, slice source_item_registry, cell content) = load_data();
  return (init?, verifier_id, verified_code_cell_hash, source_item_registry, content);

x{80DBB696AF5E9FE3D80140E31C9B8FC2B4B8FB63FF9F1BC6913F9551C77DB5689D8B05F63C0307190BBB_}
 x{00C_}
  x{2_}
   x{BFF082EB663B57A00192F4A6AC467288DF2DFEDDB9DA1BEE28F6521C8BEBD21F1EC_}
    x{0068747470733A2F2F63646E2E6A7175657279732E6465762F74656D702F49454D2E706E67}
   x{2_}
    x{2_}
     x{BF4546A6FFE1B79CFDD86BAD3DB874313DCDE2FB05E6A74AA7F3552D9617C79D13_}
      x{0049454D2048415348}
     x{BF6ED4F942A7848CE2CB066B77A1128C6A1FF8C43F438A2DCE24612BA9FFAB8B03_}
      x{0049454D}
    x{2_}
     x{BF5208DEF46F5A1D4F9DCE66AB309F4A851305F166F91EF79D923EF58E34F9A209_}
      x{0049454D20697320746865206D6F7374206C65676974206D696E696E672070726F6A656374206F6E20544F4E20616E6420746865206F6E6C79206F6E65206F66666572696E6720544F4E207265776172647320647572696E67206D696E696E672E204974206272696E677320425443E2809973206D696E696E67206D656368}
       x{616E69637320746F20796F75722070686F6E652C204A6F696E206E6F772C206974E2809973206C696B65206D697373696E6720425443E2809973206561726C7920646179732E20446F6EE280997420736C656570206F6E207468697320576562332067656D}
     x{BF5D01FA5E3C06901C45046C6B2DDCEA5AF764FEA0EED72A10D404F2312CEB247D_}
      x{0039}
 x{FF00F4A413F4BCF2C80B}
  x{62_}
   x{CC}
    x{D4_}
     x{0831C02497C138007434C0C05C6C2544D7C0FC03383E903E900C7E800C5C75C87E800C7E800C1CEA6D0000B4C7E08403E29FA954882EA54C4D167C0278208405E3514654882EA58C511100FC02B80D60841657C1EF2EA4D67C02F817C12103FCBC2_}
     x{3E910C1C2EBCB8536_}
    x{2_}
     x{2_}
      x{503D33FFA00FA4021F001ED44D0FA00FA40FA40D4305136A1522AC705F2E2C128C2FFF2E2C254344270542013541403C85004FA0258CF1601CF16CCC922C8CB0112F400F400CB00C920F9007074C8CB02CA07CBFFC9D004FA40F40431FA0020D749C200F2E2C4778018C8CB055008CF1670FA0217CB6B13CC}
       x{8210178D4519C8CB1F19CB3F5007FA0222CF165006CF1625FA025003CF16C95005CC2391729171E25008A813A08209C9C380A014BCF2E2C504C98040FB001023C85004FA0258CF1601CF16CCC9ED54}
      x{2_}
       x{3B51343E803E903E90350C0234CFFE80145468017E903E9014D6F1C1551CDB5C150804D50500F214013E809633C58073C5B33248B232C044BD003D0032C0327E401C1D3232C0B281F2FFF274140371C1472C7CB8B0C2BE80146A2860822625A019AD822860822625A028062849E5C412440E0DD7C138C34975C2C06_}
        x{5279A018A182107362D09CC8CB1F5230CB3F58FA025007CF165007CF16C9718010C8CB0524CF165006FA0215CB6A14CCC971FB0010241023}
        x{C30023C200B08E218210D53276DB708010C8CB055008CF165004FA0216CB6A12CB1F12CB3FC972FB0093356C21E203C85004FA0258CF1601CF16CCC9ED54}
       x{3B51343E803E903E90350C01F4CFFE803E900C145468549271C17CB8B049F0BFFCB8B08160824C4B402805AF3CB8B0E0841EF765F7B232C7C572CFD400FE8088B3C58073C5B25C60063232C14933C59C3E80B2DAB33260103EC01004F214013E809633C58073C5B3327B552_}
     x{D40106B90F6A2687D007D207D206A1802698FC1080BC6A28CA9105D41083DEECBEF09DD0958F97162E99F98FD001809D02811E428027D012C678B00E78B6664F6AA4_}
   x{A0F605DA89A1F401F481F481A861_}